@{
    ViewData["Title"] = "æˆ‘çš„å¯µç‰©";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] | GameCore</title>
    <style>
        /* ç¹¼æ‰¿ä¸»è¦è¨­è¨ˆç³»çµ±è®Šæ•¸ */
        :root {
            --bg: #eef3f8;
            --bg2: #ffffff;
            --ink: #1f2937;
            --muted: #64748b;
            --line: #e5e7eb;
            --surface: rgba(255,255,255,.75);
            --glass: rgba(255,255,255,.45);
            --accent: #7557ff;
            --accent-2: #34d2ff;
            --accent-3: #22c55e;
            --accent-4: #ff6b9d;
            --radius: 18px;
            --radius-sm: 12px;
            --shadow: 0 18px 40px rgba(17,24,39,.12);
            --blur: 14px;
            --pet-healthy: #22c55e;
            --pet-warning: #f59e0b;
            --pet-danger: #ef4444;
        }

        body.dark {
            --bg: #0c111b;
            --bg2: #0a0f18;
            --ink: #e5edff;
            --muted: #9fb1c9;
            --line: #1e2b43;
            --surface: rgba(22,30,48,.65);
            --glass: rgba(18,24,39,.50);
            --shadow: 0 18px 42px rgba(0,0,0,.35);
        }

        .pet-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: radial-gradient(900px 500px at -10% -10%, rgba(117,87,255,.10), transparent 60%),
                        radial-gradient(800px 460px at 110% 10%, rgba(52,210,255,.10), transparent 50%),
                        linear-gradient(180deg, var(--bg), var(--bg2));
            min-height: 100vh;
            color: var(--ink);
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", sans-serif;
        }

        .pet-header {
            background: var(--glass);
            border: 1px solid var(--line);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow);
            text-align: center;
        }

        .pet-title {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .pet-subtitle {
            color: var(--muted);
            font-size: 1.1rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .section-card {
            background: var(--glass);
            border: 1px solid var(--line);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* å¯µç‰©é¡¯ç¤ºå€åŸŸ */
        .pet-display {
            position: relative;
            height: 300px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #87CEEB, #FFB6C1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pet-display:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,.15);
        }

        .slime-pet {
            width: 120px;
            height: 120px;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            background: #ADD8E6;
            position: relative;
            animation: petBounce 2s ease-in-out infinite;
            box-shadow: 0 10px 20px rgba(0,0,0,.2);
        }

        .slime-eyes {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }

        .slime-eye {
            width: 12px;
            height: 12px;
            background: #000;
            border-radius: 50%;
            animation: petBlink 3s ease-in-out infinite;
        }

        .slime-mouth {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 10px;
            border: 2px solid #000;
            border-top: none;
            border-radius: 0 0 20px 20px;
        }

        @keyframes petBounce {
            0%, 100% { transform: translateY(0) scaleY(1); }
            50% { transform: translateY(-10px) scaleY(0.95); }
        }

        @keyframes petBlink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }

        /* å¯µç‰©è³‡è¨Š */
        .pet-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .pet-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .pet-level {
            font-size: 1rem;
            color: var(--muted);
            margin-bottom: 8px;
        }

        .pet-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            background: var(--accent-3);
            color: white;
        }

        /* å±¬æ€§æ¢ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--surface);
            border-radius: var(--radius-sm);
            border: 1px solid var(--line);
        }

        .stat-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }

        .stat-info {
            flex: 1;
        }

        .stat-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .stat-bar {
            height: 8px;
            background: var(--line);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .stat-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .stat-fill.hunger { background: linear-gradient(90deg, #ef4444, #f59e0b); }
        .stat-fill.mood { background: linear-gradient(90deg, #8b5cf6, #a855f7); }
        .stat-fill.stamina { background: linear-gradient(90deg, #06b6d4, #0891b2); }
        .stat-fill.cleanliness { background: linear-gradient(90deg, #10b981, #059669); }
        .stat-fill.health { background: linear-gradient(90deg, #ef4444, #22c55e); }

        .stat-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--muted);
        }

        /* äº’å‹•æŒ‰éˆ• */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 16px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(0,0,0,.15);
        }

        .action-btn.feed {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .action-btn.bathe {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .action-btn.play {
            background: linear-gradient(135deg, #a855f7, #9333ea);
            color: white;
        }

        .action-btn.rest {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ç¶“é©—æ¢ */
        .exp-section {
            margin-bottom: 20px;
        }

        .exp-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .exp-bar {
            height: 12px;
            background: var(--line);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        /* æ›è‰²å€åŸŸ */
        .color-section {
            border-top: 1px solid var(--line);
            padding-top: 20px;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: var(--accent);
        }

        .color-option.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--surface), 0 0 0 4px var(--accent);
        }

        .recolor-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--accent-4), #ec4899);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recolor-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
        }

        .recolor-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* è¼‰å…¥å’ŒæˆåŠŸå‹•ç•« */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--muted);
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--line);
            border-top: 2px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass);
            border: 1px solid var(--line);
            border-radius: var(--radius-sm);
            padding: 16px 20px;
            backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .success-message.show {
            opacity: 1;
            transform: translateX(0);
        }

        .success-message.success {
            border-left: 4px solid var(--accent-3);
        }

        .success-message.error {
            border-left: 4px solid var(--pet-danger);
        }

        /* å‰µå»ºå¯µç‰©ç•Œé¢ */
        .create-pet-section {
            text-align: center;
            padding: 60px 20px;
        }

        .create-pet-icon {
            font-size: 5rem;
            margin-bottom: 24px;
            opacity: 0.7;
        }

        .create-pet-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .create-pet-desc {
            color: var(--muted);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .create-pet-form {
            max-width: 300px;
            margin: 0 auto;
        }

        .create-pet-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--line);
            border-radius: var(--radius-sm);
            background: var(--surface);
            color: var(--ink);
            font-size: 1rem;
            margin-bottom: 16px;
        }

        .create-pet-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .create-pet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(117, 87, 255, 0.3);
        }

        /* è­¦å‘Šè¨Šæ¯ */
        .warning-section {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1));
            border: 1px solid var(--pet-warning);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 16px;
        }

        .warning-title {
            color: var(--pet-warning);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-list {
            color: var(--pet-danger);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .warning-list li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="pet-container">
        <!-- é é¢æ¨™é¡Œ -->
        <div class="pet-header">
            <h1 class="pet-title">æˆ‘çš„å²èŠå§†å¯µç‰©</h1>
            <p class="pet-subtitle">ç…§é¡§ä½ çš„å¯æ„›å²èŠå§†ï¼Œèˆ‡å®ƒä¸€èµ·æˆé•·å†’éšªï¼</p>
        </div>

        <!-- ä¸»è¦å…§å®¹ -->
        <div id="mainContent">
            <div class="loading">
                <div class="spinner"></div>
                <p>è¼‰å…¥å¯µç‰©è³‡è¨Šä¸­...</p>
            </div>
        </div>

        <!-- æˆåŠŸè¨Šæ¯ -->
        <div id="successMessage" class="success-message">
            <div id="messageContent"></div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let petData = null;
        let selectedColor = null;
        let availableColors = [];

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadPetData();
            loadAvailableColors();
        });

        // è¼‰å…¥å¯µç‰©è³‡æ–™
        async function loadPetData() {
            try {
                const response = await fetch('/api/pet');
                const result = await response.json();
                
                if (result.success) {
                    if (result.hasPet) {
                        petData = result.data;
                        renderPetInterface();
                    } else {
                        renderCreatePetInterface();
                    }
                } else {
                    showMessage('è¼‰å…¥å¯µç‰©è³‡æ–™å¤±æ•—', 'error');
                }
            } catch (error) {
                console.error('è¼‰å…¥å¯µç‰©è³‡æ–™å¤±æ•—:', error);
                showMessage('è¼‰å…¥å¯µç‰©è³‡æ–™å¤±æ•—', 'error');
            }
        }

        // è¼‰å…¥å¯ç”¨é¡è‰²
        async function loadAvailableColors() {
            try {
                const response = await fetch('/api/pet/colors');
                const result = await response.json();
                
                if (result.success) {
                    availableColors = result.data;
                }
            } catch (error) {
                console.error('è¼‰å…¥é¡è‰²é¸é …å¤±æ•—:', error);
            }
        }

        // æ¸²æŸ“å¯µç‰©ç•Œé¢
        function renderPetInterface() {
            const content = `
                <div class="main-layout">
                    <!-- å·¦å´ï¼šå¯µç‰©é¡¯ç¤ºå’Œäº’å‹• -->
                    <div>
                        <div class="section-card">
                            <div class="pet-display" style="background: linear-gradient(135deg, ${petData.skinColor}, ${petData.backgroundColor})" onclick="interactWithPet()">
                                <div class="slime-pet" style="background: ${petData.skinColor}">
                                    <div class="slime-eyes">
                                        <div class="slime-eye"></div>
                                        <div class="slime-eye"></div>
                                    </div>
                                    <div class="slime-mouth"></div>
                                </div>
                            </div>
                            
                            <div class="pet-info">
                                <div class="pet-name">${petData.petName}</div>
                                <div class="pet-level">ç­‰ç´š ${petData.level} â€¢ ç¶“é©— ${petData.experience}</div>
                                <div class="pet-status">${petData.petStatus}</div>
                            </div>

                            ${petData.lowStatsWarnings.length > 0 ? `
                                <div class="warning-section">
                                    <div class="warning-title">
                                        âš ï¸ å¯µç‰©éœ€è¦ç…§æ–™
                                    </div>
                                    <ul class="warning-list">
                                        ${petData.lowStatsWarnings.map(warning => `<li>${warning}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}

                            <div class="action-buttons">
                                <button class="action-btn feed" onclick="performAction('feed')" ${!petData.canAdventure ? 'disabled' : ''}>
                                    ğŸ é¤µé£Ÿ
                                </button>
                                <button class="action-btn bathe" onclick="performAction('bathe')" ${!petData.canAdventure ? 'disabled' : ''}>
                                    ğŸ› æ´—æ¾¡
                                </button>
                                <button class="action-btn play" onclick="performAction('play')" ${!petData.canAdventure ? 'disabled' : ''}>
                                    ğŸ® ç©è€
                                </button>
                                <button class="action-btn rest" onclick="performAction('rest')" ${!petData.canAdventure ? 'disabled' : ''}>
                                    ğŸ˜´ ä¼‘æ¯
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- å³å´ï¼šå±¬æ€§å’Œå…¶ä»–åŠŸèƒ½ -->
                    <div>
                        <!-- å¯µç‰©å±¬æ€§ -->
                        <div class="section-card">
                            <div class="section-title">
                                ğŸ“Š å¯µç‰©å±¬æ€§
                            </div>
                            
                            <div class="stats-grid">
                                ${renderStatBar('ğŸ', 'é£¢é¤“å€¼', petData.hunger, 'hunger')}
                                ${renderStatBar('ğŸ˜Š', 'å¿ƒæƒ…å€¼', petData.mood, 'mood')}
                                ${renderStatBar('âš¡', 'é«”åŠ›å€¼', petData.stamina, 'stamina')}
                                ${renderStatBar('ğŸ§¼', 'æ¸…æ½”å€¼', petData.cleanliness, 'cleanliness')}
                                ${renderStatBar('â¤ï¸', 'å¥åº·åº¦', petData.health, 'health')}
                            </div>
                        </div>

                        <!-- ç¶“é©—ç­‰ç´š -->
                        <div class="section-card">
                            <div class="section-title">
                                ğŸŒŸ ç¶“é©—ç­‰ç´š
                            </div>
                            
                            <div class="exp-section">
                                <div class="exp-info">
                                    <span>ç­‰ç´š ${petData.level}</span>
                                    <span>${Math.floor(petData.levelProgress)}%</span>
                                </div>
                                <div class="exp-bar">
                                    <div class="exp-fill" style="width: ${petData.levelProgress}%"></div>
                                </div>
                                <div style="font-size: 0.875rem; color: var(--muted); margin-top: 8px;">
                                    ${petData.experience} / ${petData.experience + petData.requiredExperienceForNextLevel} EXP
                                </div>
                            </div>
                        </div>

                        <!-- æ›è‰²åŠŸèƒ½ -->
                        <div class="section-card">
                            <div class="section-title">
                                ğŸ¨ å¯µç‰©æ›è‰²
                            </div>
                            
                            <div class="color-section">
                                <div class="color-palette">
                                    ${renderColorPalette()}
                                </div>
                                <button class="recolor-btn" onclick="recolorPet()" disabled id="recolorBtn">
                                    æ›è‰² (2000é»æ•¸)
                                </button>
                                <div style="font-size: 0.875rem; color: var(--muted); margin-top: 8px; text-align: center;">
                                    é¸æ“‡æ–°é¡è‰²å¾Œé»æ“Šæ›è‰²æŒ‰éˆ•
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('mainContent').innerHTML = content;
        }

        // æ¸²æŸ“å‰µå»ºå¯µç‰©ç•Œé¢
        function renderCreatePetInterface() {
            const content = `
                <div class="section-card">
                    <div class="create-pet-section">
                        <div class="create-pet-icon">ğŸ¥š</div>
                        <div class="create-pet-title">æ­¡è¿ä¾†åˆ°å¯µç‰©ä¸–ç•Œï¼</div>
                        <div class="create-pet-desc">
                            æ‚¨é‚„æ²’æœ‰å¯µç‰©ï¼Œè®“æˆ‘å€‘ç‚ºæ‚¨å»ºç«‹ä¸€éš»å¯æ„›çš„å²èŠå§†å§ï¼<br>
                            å²èŠå§†æœƒé™ªä¼´æ‚¨åœ¨GameCoreçš„å†’éšªæ—…ç¨‹ï¼Œè¨˜å¾—è¦å¥½å¥½ç…§é¡§å®ƒå“¦ï½
                        </div>
                        
                        <div class="create-pet-form">
                            <input type="text" class="create-pet-input" id="petNameInput" placeholder="å¯µç‰©åç¨± (é è¨­: å°å¯æ„›)" maxlength="50">
                            <button class="create-pet-btn" onclick="createPet()">
                                ğŸ¾ å»ºç«‹æˆ‘çš„å²èŠå§†
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('mainContent').innerHTML = content;
        }

        // æ¸²æŸ“å±¬æ€§æ¢
        function renderStatBar(icon, name, value, type) {
            return `
                <div class="stat-item">
                    <div class="stat-icon">${icon}</div>
                    <div class="stat-info">
                        <div class="stat-name">${name}</div>
                        <div class="stat-bar">
                            <div class="stat-fill ${type}" style="width: ${value}%"></div>
                        </div>
                    </div>
                    <div class="stat-value">${value}/100</div>
                </div>
            `;
        }

        // æ¸²æŸ“é¡è‰²é¸æ“‡å™¨
        function renderColorPalette() {
            return availableColors.map(color => `
                <div class="color-option" 
                     style="background: ${color.skinColor}" 
                     onclick="selectColor('${color.colorId}', '${color.skinColor}', '${color.backgroundColor}')"
                     title="${color.colorName}">
                </div>
            `).join('');
        }

        // å»ºç«‹å¯µç‰©
        async function createPet() {
            try {
                const petName = document.getElementById('petNameInput').value.trim() || 'å°å¯æ„›';
                
                const response = await fetch('/api/pet', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ petName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    setTimeout(() => {
                        loadPetData();
                    }, 1500);
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('å»ºç«‹å¯µç‰©å¤±æ•—:', error);
                showMessage('å»ºç«‹å¯µç‰©å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
            }
        }

        // åŸ·è¡Œå¯µç‰©äº’å‹•
        async function performAction(action) {
            try {
                const response = await fetch(`/api/pet/actions/${action}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    
                    // æ›´æ–°å¯µç‰©è³‡æ–™
                    setTimeout(() => {
                        loadPetData();
                    }, 1000);
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('å¯µç‰©äº’å‹•å¤±æ•—:', error);
                showMessage('å¯µç‰©äº’å‹•å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
            }
        }

        // é¸æ“‡é¡è‰²
        function selectColor(colorId, skinColor, backgroundColor) {
            // ç§»é™¤ä¹‹å‰çš„é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // è¨­å®šæ–°çš„é¸ä¸­ç‹€æ…‹
            event.target.classList.add('selected');
            
            selectedColor = { colorId, skinColor, backgroundColor };
            document.getElementById('recolorBtn').disabled = false;
        }

        // å¯µç‰©æ›è‰²
        async function recolorPet() {
            if (!selectedColor) {
                showMessage('è«‹å…ˆé¸æ“‡é¡è‰²', 'error');
                return;
            }

            if (!confirm(`ç¢ºå®šè¦èŠ±è²»2000é»æ•¸ç‚ºå¯µç‰©æ›è‰²å—ï¼Ÿ`)) {
                return;
            }

            try {
                const response = await fetch('/api/pet/recolor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        skinColor: selectedColor.skinColor,
                        backgroundColor: selectedColor.backgroundColor,
                        confirmPayment: true
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    
                    // é‡æ–°è¼‰å…¥å¯µç‰©è³‡æ–™
                    setTimeout(() => {
                        loadPetData();
                    }, 1000);
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('å¯µç‰©æ›è‰²å¤±æ•—:', error);
                showMessage('å¯µç‰©æ›è‰²å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
            }
        }

        // èˆ‡å¯µç‰©äº’å‹•ï¼ˆé»æ“Šå¯µç‰©ï¼‰
        function interactWithPet() {
            // ç°¡å–®çš„é»æ“Šåé¥‹å‹•ç•«
            const pet = document.querySelector('.slime-pet');
            pet.style.transform = 'scale(1.1)';
            setTimeout(() => {
                pet.style.transform = 'scale(1)';
            }, 200);
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type = 'success') {
            const messageElement = document.getElementById('successMessage');
            const contentElement = document.getElementById('messageContent');
            
            contentElement.textContent = message;
            messageElement.className = `success-message ${type} show`;
            
            setTimeout(() => {
                messageElement.classList.remove('show');
            }, 3000);
        }

        // ä¸»é¡Œåˆ‡æ›æ”¯æ´
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark');
        }
    </script>
</body>
</html>