<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - GameCore</title>
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    
    <!-- CSS è®Šæ•¸å®šç¾© - éµå¾ªä½¿ç”¨è€…æä¾›çš„é¢¨æ ¼ -->
    <style>
        :root {
            /* åŸºç¤è‰²å½©ç³»çµ± */
            --bg: #eef3f8;
            --bg2: #ffffff;
            --ink: #1f2937;
            --muted: #64748b;
            --line: #e5e7eb;
            --surface: rgba(255,255,255,.75);
            --glass: rgba(255,255,255,.45);
            --accent: #7557ff;
            --accent-2: #34d2ff;
            --accent-3: #22c55e;
            --radius: 18px;
            --radius-sm: 12px;
            --shadow: 0 18px 40px rgba(17,24,39,.12);
            --blur: 14px;
            
            /* ç‹€æ…‹è‰²å½© */
            --success-color: #22c55e;
            --error-color: #ff6b6b;
            --warning-color: #f59e0b;
        }

        /* æ·±è‰²ä¸»é¡Œ */
        body.dark {
            --bg: #0c111b;
            --bg2: #0a0f18;
            --ink: #e5edff;
            --muted: #9fb1c9;
            --line: #1e2b43;
            --surface: rgba(22,30,48,.65);
            --glass: rgba(18,24,39,.50);
            --shadow: 0 18px 42px rgba(0,0,0,.35);
        }

        /* åŸºç¤é‡ç½® */
        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            color: var(--ink);
            font: 16px/1.65 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
            background: 
                radial-gradient(900px 500px at -10% -10%, rgba(117,87,255,.10), transparent 60%), 
                radial-gradient(800px 460px at 110% 10%, rgba(52,210,255,.10), transparent 50%), 
                linear-gradient(180deg, var(--bg), var(--bg2));
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        button {
            font-family: inherit;
        }

        /* é˜²æ­¢æ»¾å‹•ç•¶æ¨¡æ…‹é–‹å•Ÿæ™‚ */
        body.noscroll {
            overflow: hidden;
        }

        /* Loading ç‹€æ…‹ */
        .loading {
            pointer-events: none;
        }

        /* ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--glass);
            backdrop-filter: blur(var(--blur));
            border: 1px solid var(--line);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: var(--surface);
        }

        .theme-toggle .icon {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .icon {
            transform: rotate(180deg);
        }

        /* é€šç”¨å‹•ç•«é¡ */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .slide-up {
            animation: slideUp 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* èªéŸ³å”åŠ©åŠŸèƒ½ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* ç„¡éšœç¤™ç„¦é»æ¨£å¼ */
        *:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        /* é«˜å°æ¯”æ¨¡å¼æ”¯æ´ */
        @media (prefers-contrast: high) {
            :root {
                --line: #000000;
                --muted: #333333;
                --accent: #0000ff;
            }
        }

        /* æ¸›å°‘å‹•ç•«æ¨¡å¼ */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* æ‰“å°æ¨£å¼ */
        @media print {
            .theme-toggle,
            .floating-shape,
            .auth-background {
                display: none;
            }
            
            .auth-card {
                box-shadow: none;
                border: 1px solid #000;
            }
        }
    </style>
</head>
<body class="fade-in">
    <!-- ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• -->
    <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ›æ·±è‰²/æ·ºè‰²ä¸»é¡Œ" title="åˆ‡æ›ä¸»é¡Œ">
        <span class="icon" id="themeIcon">ğŸŒ™</span>
    </button>

    <!-- ç„¡éšœç¤™è·³éé€£çµ -->
    <a href="#main-content" class="sr-only">è·³åˆ°ä¸»è¦å…§å®¹</a>

    <!-- ä¸»è¦å…§å®¹ -->
    <main id="main-content" role="main">
        @RenderBody()
    </main>

    <!-- åŸºç¤ JavaScript -->
    <script>
        // ä¸»é¡Œåˆ‡æ›åŠŸèƒ½
        (function() {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const body = document.body;
            
            // å¾ localStorage è®€å–ä¸»é¡Œè¨­å®š
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                body.classList.add('dark');
                themeIcon.textContent = 'â˜€ï¸';
            }
            
            // ä¸»é¡Œåˆ‡æ›äº‹ä»¶
            themeToggle.addEventListener('click', function() {
                body.classList.toggle('dark');
                const isDark = body.classList.contains('dark');
                
                themeIcon.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                
                // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶è®“å…¶ä»–çµ„ä»¶çŸ¥é“ä¸»é¡Œå·²æ”¹è®Š
                window.dispatchEvent(new CustomEvent('themeChanged', {
                    detail: { isDark }
                }));
            });
        })();

        // éµç›¤å°èˆªæ”¯æ´
        document.addEventListener('keydown', function(e) {
            // ESC éµé—œé–‰æ¨¡æ…‹
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal.show');
                modals.forEach(modal => {
                    modal.classList.remove('show');
                    body.classList.remove('noscroll');
                });
            }
        });

        // Toast é€šçŸ¥ç³»çµ±
        window.showToast = function(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toastContainer') || createToastContainer();
            const toast = document.createElement('div');
            toast.className = `toast ${type} slide-up`;
            toast.innerHTML = `
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                    <button class="toast-close" aria-label="é—œé–‰é€šçŸ¥">Ã—</button>
                </div>
            `;
            
            container.appendChild(toast);
            
            // è‡ªå‹•ç§»é™¤
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }
            }, duration);
            
            // æ‰‹å‹•é—œé–‰
            toast.querySelector('.toast-close').addEventListener('click', () => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }
            });
        };

        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toastContainer';
            container.className = 'toast-container';
            document.body.appendChild(container);
            return container;
        }

        // è¡¨å–®é©—è­‰è¼”åŠ©å‡½æ•¸
        window.validateEmail = function(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        };

        window.validatePassword = function(password) {
            const minLength = password.length >= 8;
            const hasUpper = /[A-Z]/.test(password);
            const hasLower = /[a-z]/.test(password);
            const hasNumber = /\d/.test(password);
            const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
            
            let score = 0;
            if (minLength) score++;
            if (hasUpper) score++;
            if (hasLower) score++;
            if (hasNumber) score++;
            if (hasSpecial) score++;
            
            return {
                isValid: minLength && (hasUpper || hasLower) && hasNumber,
                score: score,
                strength: score <= 2 ? 'weak' : score <= 3 ? 'fair' : score <= 4 ? 'good' : 'strong'
            };
        };

        // API è«‹æ±‚è¼”åŠ©å‡½æ•¸
        window.apiRequest = async function(url, options = {}) {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                credentials: 'include'
            };
            
            const requestOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            };
            
            try {
                const response = await fetch(url, requestOptions);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `HTTP error! status: ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API request failed:', error);
                throw error;
            }
        };

        // è¼‰å…¥ç‹€æ…‹ç®¡ç†
        window.setLoading = function(element, isLoading) {
            if (isLoading) {
                element.classList.add('loading');
                element.disabled = true;
                if (element.querySelector('.loading-spinner')) {
                    element.querySelector('.loading-spinner').style.display = 'block';
                }
            } else {
                element.classList.remove('loading');
                element.disabled = false;
                if (element.querySelector('.loading-spinner')) {
                    element.querySelector('.loading-spinner').style.display = 'none';
                }
            }
        };

        // éŒ¯èª¤é¡¯ç¤ºè¼”åŠ©å‡½æ•¸
        window.showError = function(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.add('show');
            }
        };

        window.hideError = function(elementId) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.classList.remove('show');
            }
        };

        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç§»é™¤è¼‰å…¥å‹•ç•«
            setTimeout(() => {
                document.body.classList.add('loaded');
            }, 100);
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

<style>
/* Toast é€šçŸ¥æ¨£å¼ */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    max-width: 400px;
}

.toast {
    background: var(--glass);
    backdrop-filter: blur(var(--blur));
    border: 1px solid var(--line);
    border-radius: var(--radius-sm);
    margin-bottom: 12px;
    box-shadow: var(--shadow);
    overflow: hidden;
    position: relative;
}

.toast.success {
    border-left: 4px solid var(--success-color);
}

.toast.error {
    border-left: 4px solid var(--error-color);
}

.toast.warning {
    border-left: 4px solid var(--warning-color);
}

.toast.info {
    border-left: 4px solid var(--accent);
}

.toast-content {
    display: flex;
    align-items: flex-start;
    padding: 16px;
    gap: 12px;
}

.toast-message {
    flex: 1;
    font-size: 14px;
    line-height: 1.4;
    color: var(--ink);
}

.toast-close {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 18px;
    line-height: 1;
    padding: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.toast-close:hover {
    color: var(--ink);
}

@keyframes slideOut {
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

/* éŸ¿æ‡‰å¼èª¿æ•´ */
@media (max-width: 480px) {
    .toast-container {
        left: 16px;
        right: 16px;
        top: 16px;
        max-width: none;
    }
    
    .theme-toggle {
        top: 16px;
        right: 16px;
        width: 44px;
        height: 44px;
    }
}
</style>