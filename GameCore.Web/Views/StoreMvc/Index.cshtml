@model GameCore.Web.Controllers.StoreMvcController.StoreIndexViewModel
@{
    ViewData["Title"] = "GameCore å®˜æ–¹å•†åŸ";
    ViewData["Description"] = "ç²¾é¸éŠæˆ²è»Ÿé«”ã€ç¡¬é«”å‘¨é‚Šï¼Œäº«å—æœ€ä½³éŠæˆ²é«”é©—";
}

@section Styles {
    <style>
        .store-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
            margin-bottom: 2rem;
        }
        
        .category-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        
        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f8f9fa;
        }
        
        .price-tag {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .search-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .filter-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .pagination .page-link {
            padding: 0.5rem 1rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            color: #007bff;
            text-decoration: none;
        }
        
        .pagination .page-link:hover {
            background-color: #e9ecef;
        }
        
        .pagination .page-link.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
}

<!-- å•†åŸè‹±é›„å€ -->
<section class="store-hero">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-3">GameCore å®˜æ–¹å•†åŸ</h1>
                <p class="lead mb-4">ç²¾é¸éŠæˆ²è»Ÿé«”ã€ç¡¬é«”å‘¨é‚Šï¼Œäº«å—æœ€ä½³éŠæˆ²é«”é©—</p>
                <div class="d-flex gap-3">
                    <a href="#products" class="btn btn-light btn-lg">ç«‹å³è³¼ç‰©</a>
                    <a href="#categories" class="btn btn-outline-light btn-lg">ç€è¦½åˆ†é¡</a>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <div class="position-relative">
                    <div class="bg-white bg-opacity-10 rounded-circle d-inline-block p-5">
                        <i class="fas fa-gamepad fa-5x text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- æœå°‹èˆ‡ç¯©é¸å€ -->
<section class="search-section">
    <div class="container">
        <form method="get" action="@Url.Action("Index", "StoreMvc")" id="searchForm">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" class="form-control form-control-lg" 
                           name="search" value="@Model.CurrentSearch" 
                           placeholder="æœå°‹å•†å“...">
                </div>
                <div class="col-md-3">
                    <select class="form-select form-select-lg" name="category">
                        <option value="">æ‰€æœ‰åˆ†é¡</option>
                        @foreach (var category in Model.Categories)
                        {
                            <option value="@category" @(category == Model.CurrentCategory ? "selected" : "")>
                                @category
                            </option>
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control" name="minPrice" 
                           value="@Model.CurrentMinPrice" placeholder="æœ€ä½åƒ¹æ ¼">
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control" name="maxPrice" 
                           value="@Model.CurrentMaxPrice" placeholder="æœ€é«˜åƒ¹æ ¼">
                </div>
                <div class="col-md-1">
                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </form>
    </div>
</section>

<!-- å•†å“åˆ†é¡å€ -->
<section id="categories" class="mb-5">
    <div class="container">
        <h2 class="text-center mb-4">å•†å“åˆ†é¡</h2>
        <div class="row g-4">
            @foreach (var category in Model.Categories.Take(6))
            {
                <div class="col-md-4 col-lg-2">
                    <a href="@Url.Action("Category", "StoreMvc", new { category = category })" 
                       class="text-decoration-none">
                        <div class="category-card">
                            <div class="mb-3">
                                <i class="fas fa-tags fa-2x text-primary"></i>
                            </div>
                            <h6 class="mb-0">@category</h6>
                        </div>
                    </a>
                </div>
            }
        </div>
    </div>
</section>

<!-- ç†±é–€å•†å“å€ -->
@if (Model.PopularProducts.Any())
{
    <section class="mb-5">
        <div class="container">
            <h2 class="text-center mb-4">ç†±é–€å•†å“</h2>
            <div class="row g-4">
                @foreach (var product in Model.PopularProducts)
                {
                    <div class="col-md-6 col-lg-3">
                        <div class="product-card h-100">
                            <img src="@(string.IsNullOrEmpty(product.ImageUrl) ? "/images/placeholder.jpg" : product.ImageUrl)" 
                                 alt="@product.ProductName" class="product-image">
                            <div class="p-3">
                                <h6 class="mb-2">@product.ProductName</h6>
                                <p class="text-muted small mb-2">@product.Category</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="price-tag">NT$ @product.Price.ToString("N0")</span>
                                    <a href="@Url.Action("Product", "StoreMvc", new { id = product.ProductId })" 
                                       class="btn btn-outline-primary btn-sm">æŸ¥çœ‹è©³æƒ…</a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
}

<!-- å•†å“åˆ—è¡¨å€ -->
<section id="products" class="mb-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">
                @if (!string.IsNullOrEmpty(Model.CurrentSearch))
                {
                    <span>æœå°‹çµæœï¼š@Model.CurrentSearch</span>
                }
                else if (!string.IsNullOrEmpty(Model.CurrentCategory))
                {
                    <span>@Model.CurrentCategory åˆ†é¡</span>
                }
                else
                {
                    <span>æ‰€æœ‰å•†å“</span>
                }
            </h2>
            <div class="text-muted">
                å…± @Model.Products.Count ä»¶å•†å“
            </div>
        </div>

        @if (Model.Products.Any())
        {
            <div class="row g-4">
                @foreach (var product in Model.Products)
                {
                    <div class="col-md-6 col-lg-4">
                        <div class="product-card h-100">
                            <img src="@(string.IsNullOrEmpty(product.ImageUrl) ? "/images/placeholder.jpg" : product.ImageUrl)" 
                                 alt="@product.ProductName" class="product-image">
                            <div class="p-3">
                                <h6 class="mb-2">@product.ProductName</h6>
                                <p class="text-muted small mb-2">@product.Category</p>
                                <p class="text-muted small mb-3">@(product.Description?.Length > 100 ? product.Description.Substring(0, 100) + "..." : product.Description)</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="price-tag">NT$ @product.Price.ToString("N0")</span>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary btn-sm add-to-cart" 
                                                data-product-id="@product.ProductId">
                                            <i class="fas fa-cart-plus"></i> åŠ å…¥è³¼ç‰©è»Š
                                        </button>
                                        <a href="@Url.Action("Product", "StoreMvc", new { id = product.ProductId })" 
                                           class="btn btn-outline-primary btn-sm">è©³æƒ…</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- åˆ†é  -->
            @if (Model.TotalPages > 1)
            {
                <nav class="pagination">
                    @if (Model.CurrentPage > 1)
                    {
                        <a class="page-link" href="@Url.Action("Index", "StoreMvc", new { 
                            category = Model.CurrentCategory, 
                            search = Model.CurrentSearch, 
                            minPrice = Model.CurrentMinPrice, 
                            maxPrice = Model.CurrentMaxPrice, 
                            page = Model.CurrentPage - 1 
                        })">ä¸Šä¸€é </a>
                    }

                    @for (int i = Math.Max(1, Model.CurrentPage - 2); i <= Math.Min(Model.TotalPages, Model.CurrentPage + 2); i++)
                    {
                        <a class="page-link @(i == Model.CurrentPage ? "active" : "")" 
                           href="@Url.Action("Index", "StoreMvc", new { 
                               category = Model.CurrentCategory, 
                               search = Model.CurrentSearch, 
                               minPrice = Model.CurrentMinPrice, 
                               maxPrice = Model.CurrentMaxPrice, 
                               page = i 
                           })">@i</a>
                    }

                    @if (Model.CurrentPage < Model.TotalPages)
                    {
                        <a class="page-link" href="@Url.Action("Index", "StoreMvc", new { 
                            category = Model.CurrentCategory, 
                            search = Model.CurrentSearch, 
                            minPrice = Model.CurrentMinPrice, 
                            maxPrice = Model.CurrentMaxPrice, 
                            page = Model.CurrentPage + 1 
                        })">ä¸‹ä¸€é </a>
                    }
                </nav>
            }
        }
        else
        {
            <div class="text-center py-5">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„å•†å“</h4>
                <p class="text-muted">è«‹å˜—è©¦èª¿æ•´æœå°‹æ¢ä»¶æˆ–ç€è¦½å…¶ä»–åˆ†é¡</p>
                <a href="@Url.Action("Index", "StoreMvc")" class="btn btn-primary">è¿”å›é¦–é </a>
            </div>
        }
    </div>
</section>

<!-- éŠ·å”®æ’è¡Œæ¦œå€ -->
@if (Model.SalesRanking.Any())
{
    <section class="mb-5">
        <div class="container">
            <h2 class="text-center mb-4">æœ¬é€±éŠ·å”®æ’è¡Œæ¦œ</h2>
            <div class="row g-4">
                @foreach (var (product, index) in Model.SalesRanking.Select((p, i) => (p, i + 1)))
                {
                    <div class="col-md-6 col-lg-4">
                        <div class="product-card h-100 position-relative">
                            @if (index <= 3)
                            {
                                <div class="position-absolute top-0 start-0 m-2">
                                    <span class="badge @(index == 1 ? "bg-warning" : index == 2 ? "bg-secondary" : "bg-danger") fs-6">
                                        @(index == 1 ? "ğŸ¥‡" : index == 2 ? "ğŸ¥ˆ" : "ğŸ¥‰") ç¬¬ @index å
                                    </span>
                                </div>
                            }
                            <img src="@(string.IsNullOrEmpty(product.ImageUrl) ? "/images/placeholder.jpg" : product.ImageUrl)" 
                                 alt="@product.ProductName" class="product-image">
                            <div class="p-3">
                                <h6 class="mb-2">@product.ProductName</h6>
                                <p class="text-muted small mb-2">@product.Category</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="price-tag">NT$ @product.Price.ToString("N0")</span>
                                    <a href="@Url.Action("Product", "StoreMvc", new { id = product.ProductId })" 
                                       class="btn btn-outline-primary btn-sm">æŸ¥çœ‹è©³æƒ…</a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // åŠ å…¥è³¼ç‰©è»ŠåŠŸèƒ½
            $('.add-to-cart').click(function() {
                const productId = $(this).data('product-id');
                const button = $(this);
                
                // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
                if (!@User.Identity.IsAuthenticated.ToString().ToLower()) {
                    window.location.href = '/Auth/Login';
                    return;
                }
                
                // ç™¼é€åŠ å…¥è³¼ç‰©è»Šè«‹æ±‚
                $.ajax({
                    url: '/api/Store/cart/add',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        productId: productId,
                        quantity: 1
                    }),
                    success: function(response) {
                        if (response.success) {
                            button.html('<i class="fas fa-check"></i> å·²åŠ å…¥');
                            button.removeClass('btn-primary').addClass('btn-success');
                            
                            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                            showToast('æˆåŠŸåŠ å…¥è³¼ç‰©è»Šï¼', 'success');
                        } else {
                            showToast(response.message || 'åŠ å…¥è³¼ç‰©è»Šå¤±æ•—', 'error');
                        }
                    },
                    error: function() {
                        showToast('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                    }
                });
            });
            
            // é¡¯ç¤º Toast è¨Šæ¯
            function showToast(message, type) {
                const toast = $(`
                    <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : 'danger'} border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">${message}</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `);
                
                $('.toast-container').append(toast);
                const bsToast = new bootstrap.Toast(toast[0]);
                bsToast.show();
                
                // è‡ªå‹•ç§»é™¤
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
        });
    </script>
} 